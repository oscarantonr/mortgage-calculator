<div class="mortgage-calculator">
  <div class="calculator-layout">
    <!-- Columna izquierda: formulario -->
    <div class="calculator-card">
      <h2>Calculadora de hipoteca</h2>
      <form [formGroup]="mortgageForm" (ngSubmit)="calculateMortgage()">
        <div class="form-group">
          <label for="loanAmount">Importe del préstamo</label>
          <div class="input-group">
            <input 
              type="text" 
              id="loanAmount" 
              formControlName="loanAmount" 
              class="form-control" 
              placeholder="Ej: 150.000"
              appEuropeanNumberInput>
            <span class="input-addon">€</span>
          </div>
          <div class="form-error" *ngIf="mortgageForm.get('loanAmount')?.invalid && mortgageForm.get('loanAmount')?.touched">
            El importe del préstamo es obligatorio y debe ser mayor que 0
          </div>
        </div>

        <div class="form-group">
          <label for="earlyRepayment">Amortización anticipada (opcional)</label>
          <div class="input-group">
            <input 
              type="text" 
              id="earlyRepayment" 
              formControlName="earlyRepayment" 
              class="form-control" 
              placeholder="Ej: 10.000"
              appEuropeanNumberInput>
            <span class="input-addon">€</span>
          </div>
          <div class="form-hint">
            Cantidad que deseas amortizar anticipadamente
          </div>
        </div>

        <div class="form-group">
          <label>Tipo de interés</label>
          <div class="radio-group">
            <div *ngFor="let type of interestTypes" class="radio-option">
              <input type="radio" [id]="type.value" [value]="type.value" formControlName="interestType">
              <label [for]="type.value">{{ type.label }}</label>
            </div>
          </div>
        </div>

        <div class="form-group" *ngIf="mortgageForm.get('interestType')?.value === 'fixed'">
          <label for="interestRate">Interés fijo (%)</label>
          <div class="input-group">
            <input 
              type="text" 
              id="interestRate" 
              formControlName="interestRate" 
              class="form-control" 
              placeholder="Ej: 3,5"
              >
            <span class="input-addon">%</span>
          </div>
        </div>

        <div *ngIf="mortgageForm.get('interestType')?.value === 'variable'">
          <div class="form-group">
            <label>Euríbor actual</label>
            <div class="input-group">
              <input type="text" [value]="currentEuribor | europeanNumber" class="form-control" disabled>
              <span class="input-addon">%</span>
            </div>
          </div>

          <div class="form-group">
            <label for="differential">Diferencial (%)</label>
            <div class="input-group">
              <input 
                type="text" 
                id="differential" 
                formControlName="differential" 
                class="form-control" 
                placeholder="Ej: 1,0"
                appEuropeanNumberInput>
              <span class="input-addon">%</span>
            </div>
          </div>

          <div class="form-group">
            <label for="interestRate">Interés resultante</label>
            <div class="input-group">
              <input type="text" id="interestRate" formControlName="interestRate" class="form-control" readonly>
              <span class="input-addon">%</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="term">Plazo</label>
          <div class="term-inputs">
            <div class="input-group">
              <input 
                type="text" 
                id="term" 
                formControlName="term" 
                class="form-control"
                [placeholder]="mortgageForm.get('termType')?.value === 'years' ? 'Ej: 30' : 'Ej: 360'"
                appEuropeanNumberInput>
                  <span class="input-addon">{{ mortgageForm.get('termType')?.value === 'years' ? 'años' : 'meses' }}</span>

            </div>
            <div class="radio-group term-type">
              <div *ngFor="let type of termTypes" class="radio-option">
                <input type="radio" [id]="'term-' + type.value" [value]="type.value" formControlName="termType">
                <label [for]="'term-' + type.value">{{ type.label }}</label>
              </div>
            </div>
          </div>
          <div class="form-error" *ngIf="mortgageForm.get('term')?.invalid && mortgageForm.get('term')?.touched">
            <span *ngIf="mortgageForm.get('termType')?.value === 'years'">El plazo debe estar entre 1 y 40 años</span>
            <span *ngIf="mortgageForm.get('termType')?.value === 'months'">El plazo debe estar entre 1 y 480 meses</span>
          </div>
        </div>

        <div class="form-group buttons">
          <button type="submit" class="btn-primary" [disabled]="mortgageForm.invalid">Calcular hipoteca</button>
          <button type="button" class="btn-secondary" (click)="resetCalculator()">Reiniciar</button>
        </div>
      </form>
    </div>

    <!-- Columna derecha: resumen de resultados -->
    <div class="results-summary-container" *ngIf="showResults">
      <div class="results-card summary-card">
        <h2 *ngIf="!mortgageForm.get('earlyRepayment')?.value">Resumen</h2>
        <h2 *ngIf="mortgageForm.get('earlyRepayment')?.value">Opciones de amortización</h2>
        
        <div class="result-summary" *ngIf="!mortgageForm.get('earlyRepayment')?.value">
          <div class="result-item">
            <h3>Cuota mensual</h3>
            <p class="result-value">{{ monthlyPayment | europeanNumber }} €</p>
          </div>
          
          <div class="result-item">
            <h3>Intereses totales</h3>
            <p class="result-value">{{ totalInterest | europeanNumber }} €</p>
          </div>
          
          <div class="result-item">
            <h3>Importe total</h3>
            <p class="result-value">{{ totalAmount | europeanNumber }} €</p>
          </div>
          
          <div class="result-item">
            <h3>Plazo total</h3>
            <p class="result-value">
              <span *ngIf="mortgageForm.get('termType')?.value === 'years'">
                {{ mortgageForm.get('term')?.value }} años 
                ({{ mortgageForm.get('term')?.value * 12 }} meses)
              </span>
              <span *ngIf="mortgageForm.get('termType')?.value === 'months'">
                {{ (mortgageForm.get('term')?.value / 12).toFixed(1) }} años 
                ({{ mortgageForm.get('term')?.value }} meses)
              </span>
            </p>
          </div>
        </div>
        
        <!-- Resultados de amortización anticipada -->
        <div class="early-repayment-results" *ngIf="mortgageForm.get('earlyRepayment')?.value">
          <h3 class="section-title">Comparativa de opciones</h3>
          
          <!-- Opción 1: Reducir plazo -->
          <div class="amortization-option">
            <div class="option-header">
              <h4>Reduciendo plazo ahorras:</h4>
              <span class="savings">{{ earlyRepaymentResults.reducingTerm.savings | europeanNumber }} €</span>
            </div>
            
            <div class="option-details">
              <div class="detail-item">
                <span class="detail-label">Cuota:</span>
                <span class="detail-value">{{ earlyRepaymentResults.reducingTerm.monthlyPayment | europeanNumber }} € <small>(se mantiene)</small></span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Plazo actual:</span>
                <span class="detail-value">
                  {{ earlyRepaymentResults.reducingTerm.originalTerm.years }} años
                  <span *ngIf="earlyRepaymentResults.reducingTerm.originalTerm.months > 0">
                    y {{ earlyRepaymentResults.reducingTerm.originalTerm.months }} meses
                  </span>
                </span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Reducción del plazo:</span>
                <span class="detail-value highlight">
                  {{ earlyRepaymentResults.reducingTerm.termReduction.years }} años
                  <span *ngIf="earlyRepaymentResults.reducingTerm.termReduction.months > 0">
                    y {{ earlyRepaymentResults.reducingTerm.termReduction.months }} meses
                  </span>
                </span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Nuevo plazo:</span>
                <span class="detail-value">
                  {{ earlyRepaymentResults.reducingTerm.newTerm.years }} años
                  <span *ngIf="earlyRepaymentResults.reducingTerm.newTerm.months > 0">
                    y {{ earlyRepaymentResults.reducingTerm.newTerm.months }} meses
                  </span>
                </span>
              </div>
            </div>
          </div>
          
          <!-- Opción 2: Reducir cuota -->
          <div class="amortization-option">
            <div class="option-header">
              <h4>Reduciendo cuota ahorras:</h4>
              <span class="savings">{{ earlyRepaymentResults.reducingPayment.savings | europeanNumber }} €</span>
            </div>
            
            <div class="option-details">
              <div class="detail-item">
                <span class="detail-label">Plazo:</span>
                <span class="detail-value">
                  {{ earlyRepaymentResults.reducingPayment.term.years }} años
                  <span *ngIf="earlyRepaymentResults.reducingPayment.term.months > 0">
                    y {{ earlyRepaymentResults.reducingPayment.term.months }} meses
                  </span>
                  <small>(se mantiene)</small>
                </span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Cuota actual:</span>
                <span class="detail-value">{{ earlyRepaymentResults.reducingPayment.originalPayment | europeanNumber }} €</span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Reducción de cuota:</span>
                <span class="detail-value highlight">{{ earlyRepaymentResults.reducingPayment.paymentReduction | europeanNumber }} €</span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Nueva cuota:</span>
                <span class="detail-value">{{ earlyRepaymentResults.reducingPayment.newPayment | europeanNumber }} €</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de amortización abajo (siempre a ancho completo) -->
  <div class="amortization-table-container" *ngIf="showResults">
    <div class="results-card">
      <h3>Tabla de amortización (primer año)</h3>
      <div class="amortization-table">
        <table>
          <thead>
            <tr>
              <th>Mes</th>
              <th>Cuota</th>
              <th>Amortización</th>
              <th>Intereses</th>
              <th>Capital pendiente</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of amortizationSchedule">
              <td>{{ row.month }}</td>
              <td>{{ row.payment | europeanNumber }} €</td>
              <td>{{ row.principalPayment | europeanNumber }} €</td>
              <td>{{ row.interest | europeanNumber }} €</td>
              <td>{{ row.balance | europeanNumber }} €</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>